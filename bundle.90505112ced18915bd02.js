(()=>{"use strict";class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}clear(){return this.html(""),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}get data(){return this.$el.dataset}closest(t){return e(this.$el.closest(t))}getCoords(){return this.$el.getBoundingClientRect()}id(t){if(t){const t=this.id().split(":");return{row:+t[0],col:+t[1]}}return this.data.id}find(t){return e(this.$el.querySelector(t))}findAllSelectors(t){return this.$el.querySelectorAll(t)}focus(){return this.$el.focus(),this}addClass(t){return this.$el.classList.add(t)}removeClass(t){return this.$el.classList.remove(t)}css(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach((e=>this.$el.style[e]=t[e]))}}function e(e){return new t(e)}function n(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,n)=>t+n))}e.create=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=document.createElement(t);return n&&r.classList.add(n),e(r)};class r{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)throw new Error("No $root provided for DomListener");this.$root=t,this.listeners=e}initDomListeners(){this.listeners.forEach((t=>{const e=i(t);if(!this[e]){const t=this.name||"";throw new Error("Method ".concat(e," is not implemented in ").concat(t," component"))}this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeDomListeners(){this.listeners.forEach((t=>{const e=i(t);this.$root.off(t,this[e])}))}}function i(t){return"on"+("string"!=typeof(e=t)?"":e.charAt(0).toLocaleUpperCase()+e.slice(1));var e}class o extends r{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e.listeners),this.name=e.name||"",this.prepare()}prepare(){}toHTML(){return""}init(){this.initDomListeners()}destroy(){this.removeDomListeners()}}class s extends o{constructor(t){super(t,{name:"Formula",listeners:["input","click"]})}toHTML(){return'\n      <div class="info">fx</div>\n      <div class="input" contenteditable spellcheck="false"></div>\n    '}onInput(t){console.log("Formula: onInput",t)}onClick(){console.log("click")}}var c,a,l,u;c=s,l="excel__formula",(a="symbol"==typeof(u=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(a="className"))?u:u+"")in c?Object.defineProperty(c,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):c[a]=l;class d extends o{toHTML(){return'\n    <input class="input" type="text" value="Новая таблица"/>\n    <div>\n      <div class="button">\n        <i class="material-icons">delete</i>\n      </div>\n      <div class="button">\n        <i class="material-icons">exit_to_app</i>\n      </div>\n    </div>\n    '}}!function(t,e,n){e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(d,"className","excel__header");const h=65,f=90;function m(t){return function(e,n){return' <div \n    class="cell" \n    contenteditable \n    data-col="'.concat(n,'"\n    data-type="cell"\n    data-id="').concat(t,":").concat(n,'"\n    ></div>')}}function p(t,e){return'\n    <div \n    class="column" \n    data-type="resizable" \n    data-col="'.concat(e,'"\n    >\n      ').concat(t,'\n      <div class="col-resize" data-resize="col"></div>\n    </div>\n    ')}function v(t,e){const n=t?'<div class="row-resize" data-resize="row"></div>':"";return'\n    <div class="row" data-type="resizable">\n        <div class="row-info">\n          '.concat(t||"","\n          ").concat(n,'\n        </div>\n        <div class="row-data">').concat(e,"</div>\n    </div>\n    ")}function b(t,e){return String.fromCharCode(h+e)}class y{constructor(){this.group=[],this.current=null}select(t){this.clear(),t.focus().addClass(y.className),this.group.push(t),this.current=t}clear(){this.group.forEach((t=>t.removeClass(y.className))),this.group=[]}selectGroup(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.clear(),this.group=t,this.group.forEach((t=>t.addClass(y.className)))}}!function(t,e,n){e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(y,"className","selected");class g extends o{constructor(t){super(t,{listeners:["mousedown","keydown"]})}prepare(){this.selection=new y}toHTML(){return function(t){const e=f-h+1,n=[],r=new Array(e).fill("").map(b).map(p).join("");n.push(v(null,r));for(let t=0;t<10;t++){const r=new Array(e).fill("").map(m(t)).join("");n.push(v(t+1,r))}return n.join("")}()}init(){super.init();const t=this.$root.find('[data-id="0:0"]');this.selection.select(t)}onMousedown(t){if(function(t){return t.target.dataset.resize}(t))!function(t,n){const r=e(n.target),i=r.closest('[data-type="resizable"]'),o=i.getCoords(),s=r.data.resize,c="col"===s?"bottom":"right";let a;r.css({opacity:1,[c]:"-3000px"}),document.onmousemove=t=>{if("col"===s){const e=t.pageX-o.right;a=o.width+e;const n=40;a=Math.max(a,n);const i=o.width-n,s=Math.min(-e,i);r.css({right:"".concat(s,"px")})}else{const e=t.pageY-o.bottom;a=o.height+e;const n=20;a=Math.max(a,n);const i=o.height-n,s=Math.min(-e,i);r.css({bottom:"".concat(s,"px")})}},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,"col"===s?(i.css({width:a+"px"}),t.findAllSelectors('[data-col="'.concat(i.data.col,'"]')).forEach((t=>t.style.width=a+"px"))):i.css({height:a+"px"}),r.css({opacity:0,right:0,bottom:0})}}(this.$root,t);else if(function(t){return"cell"===t.target.dataset.type}(t)){const r=e(t.target);if(t.shiftKey){const t=function(t,e){const r=t.id(!0),i=e.id(!0),o=n(i.col,r.col),s=n(i.row,r.row);return o.reduce(((t,e)=>(s.forEach((n=>t.push("".concat(n,":").concat(e)))),t)),[])}(r,this.selection.current).map((t=>this.$root.find('[data-id="'.concat(t,'"]'))));this.selection.selectGroup(t)}else this.selection.select(r)}}onKeydown(t){const{key:e,shiftKey:n}=t;if(["Enter","Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e)&&!n){t.preventDefault();const n=this.selection.current.id(!0),r=this.$root.find(function(t,e){let{row:n,col:r}=e;const i=f-h;switch(t){case"Enter":case"ArrowDown":n=n+1>9?9:n+1;break;case"Tab":case"ArrowRight":r=r+1>i?25:r+1;break;case"ArrowLeft":r=r-1<0?0:r-1;break;case"ArrowUp":n=n-1<0?0:n-1}return'[data-id="'.concat(n,":").concat(r,'"]')}(e,n));this.selection.select(r)}}}!function(t,e,n){e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(g,"className","excel__table");class w extends o{constructor(t){super(t,{name:"Toolbar",listeners:["click"]})}toHTML(){return'\n    <div class="button">\n      <i class="material-icons">format_align_left</i>\n    </div>\n    <div class="button">\n      <i class="material-icons">format_align_center</i>\n    </div>\n    <div class="button">\n      <i class="material-icons">format_align_right</i>\n    </div>\n    <div class="button">\n      <i class="material-icons">format_bold</i>\n    </div>\n    <div class="button">\n      <i class="material-icons">format_italic</i>\n    </div>\n    <div class="button">\n      <i class="material-icons">format_underlined</i>\n    </div>\n    '}onClick(t){console.log(t.target)}}!function(t,e,n){e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(w,"className","excel__toolbar"),new class{constructor(t,n){this.$el=e(t),this.components=n.components||[]}getRoot(){const t=e.create("div","excel");return this.components=this.components.map((n=>{const r=e.create("div",n.className),i=new n(r);return i.name&&(window["c"+i.name]=i),r.html(i.toHTML()),t.append(r),i})),t}render(){this.$el.append(this.getRoot()),this.components.forEach((t=>t.init()))}}("#app",{components:[d,w,s,g]}).render()})();